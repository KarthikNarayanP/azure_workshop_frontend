trigger:
- master
pool:
  vmImage: 'ubuntu-latest'
variables:
  backendPublicIP: 52.142.14.134
  region: South India
  bucket: Temp
steps:
- bash: |
    echo "Environmental Valued"
  env:
   backendIP: $(backendPublicIP)
   publicIP: $(backendPublicIP)
- task: NodeTool@0
  inputs:
    versionSpec: '12.x'
  displayName: 'Install Node.js'

- script: |
    echo "Environmental Value $(backendPublicIP)"
    npm install
  displayName: 'npm install'
- script: |
    export backendIP=$(backendPublicIP)
    npm run scan
  displayName: 'Static Code Analysis'

- script: |
    - curl -s --connect-timeout 8 -d "{\"privateIP\":\"$(backendPublicIP)\",\"publicIP\":\"$(backendPublicIP)\",\"region\":\"$(region)\",\"bucket\":\"$(bucket)\"}"   -H 'Content-Type:application/json' http://$(backendPublicIP):3337/api/v1/aws_dashboard_report/secrets/update || true
    export backendIP=$(backendPublicIP)
    npm test
    npm run scan
  displayName: 'Execute Unit Test'

- script: |
    docker build -t mythicalmysfits:latest .
  displayName: 'Build Docker Image'
